(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const a of e)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(e){const a={};return e.integrity&&(a.integrity=e.integrity),e.referrerPolicy&&(a.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?a.credentials="include":e.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(e){if(e.ep)return;e.ep=!0;const a=i(e);fetch(e.href,a)}})();const _={javascript:{name:"Javascript",language:"javascript",ext:"js",style:{color:"#888b4e"}},lua:{name:"Lua",language:"lua",ext:"lua",style:{color:"#4e6c8b"}}},p="javascript";function r(o,t){const i=document.createElement(o);return t!==void 0&&i.classList.add(t),i}const l={root:{"background-color":"#1e1e1e",overflow:"hidden"},body:{width:"100%",height:"100%",display:"flex","flex-direction":"column"},toolbar:{"flex-grow":"1","padding-left":"1em","padding-right":"1em","padding-top":"0.5em","padding-bottom":"1em",display:"flex","flex-direction":"row",gap:"0.5em"},languages:{"font-weight":"bold","flex-grow":"1","text-align":"right"},editor:{width:"100%",height:"100%"}};class b{constructor(t,i,n){this._cachedValue=new Map,this._ui={},this._factory=t,this._options=n,C(i)&&(this._ui.element=i,this._options={...n},this._attach())}_attach(){if(this._ui.element!==void 0){{const t=r("div","moroboxai-editor");Object.assign(t.style,l.root),this._options.width!==void 0&&(t.style.width=this._options.width),this._options.height!==void 0&&(t.style.height=this._options.height),this._ui.base=t,this._ui.element.appendChild(t)}{const t=r("div","moroboxai-body");Object.assign(t.style,l.body),this._ui.base.appendChild(t);{const i=r("div","moroboxai-toolbar");Object.assign(i.style,l.toolbar),this._ui.toolbar=i,t.appendChild(i)}{const i=r("div");Object.assign(i.style,l.editor),this._ui.wrapper=i,t.appendChild(i)}}{const t=r("input");t.type="button",t.value="Run",t.onclick=()=>this._notifyRun(),this._ui.runButton=t,this._ui.toolbar.appendChild(t)}{const t=r("input");t.type="button",t.value="Stop",t.onclick=()=>this._notifyStop(),this._ui.stopButton=t,this._ui.toolbar.appendChild(t)}{const t=r("div","moroboxai-languages");Object.assign(t.style,l.languages),this._ui.toolbar.appendChild(t);const i=r("select");i.onchange=n=>this._notifyLanguageChanged(i.value),t.appendChild(i),this._ui.languageSelect=i,Object.values(_).forEach(n=>{const e=r("option");e.value=n.language,e.textContent=n.name,i.appendChild(e)})}this._ui.editor=this._factory({element:this._ui.wrapper,language:this._options.language??p}),this._ui.languageSelect.value=this.language,this._update({language:this.language,url:this._options.url,value:this._options.value})}}_notifyRun(){this._options.onRun&&this._options.onRun({language:this.language,script:this.value})}_notifyStop(){this._options.onStop&&this._options.onStop()}_notifyLanguageChanged(t){this.language=t,this._options.onLanguageChanged&&this._options.onLanguageChanged(t)}get language(){return this._ui.editor!==void 0?this._ui.editor.language:p}set language(t){this._update({language:t})}get url(){return this._url}set url(t){this._update({language:this.language,url:t})}get value(){return this._ui.editor!==void 0?this._ui.editor.value:""}set value(t){this._update({language:this.language,value:t})}_update(t){const i=t.url!==void 0||t.value!==void 0;i&&(this._options.url=t.url,this._options.value=t.value);const n=t.language??this.language,e=this._options.url,a=this._options.value;new Promise((s,c)=>{if(!i){const u=this._cachedValue.get(n);if(u!==void 0)return s(u)}if(e!==void 0){let u;return typeof e=="string"?u=e:typeof e=="function"&&(u=e(n)),u===void 0?s(void 0):(u=u.replace("*",_[n].ext),fetch(u).then(g=>g.text()).then(g=>s(g)))}let d;return d===void 0&&a!==void 0&&(typeof a=="string"?d=a:typeof a=="function"&&(d=a(n))),s(d)}).then(s=>{const c=this.value;c!==void 0&&this._cachedValue.set(this.language,c),this._ui.editor!==void 0&&(this._ui.editor.language=n,s!==void 0&&(this._ui.editor.value=s))})}onRun(t){this._options.onRun=t}onStop(t){this._options.onStop=t}onLanguageChanged(t){this._options.onLanguageChanged=t}resize(){var t;(t=this._ui.editor)==null||t.resize()}remove(){this._ui.editor!==void 0&&(this._ui.editor.remove(),this._ui.editor=void 0),this._ui.base!==void 0&&(this._ui.base.remove(),this._ui.base=void 0)}}function x(){return{language:p}}function w(o){return o!==void 0&&!m(o)&&!("className"in o)}function C(o){return"dataset"in o}function m(o){return"length"in o}function v(o,t,i){return new b(o,t,i)}function L(o,t,i){let n,e=x();return w(t)?i=t:n=t,i!==void 0&&(e={...e,...i}),n==null&&(e.element!==void 0?n=e.element:n=document.getElementsByClassName("moroboxai-editor")),m(n)?Array.prototype.map.call(n,a=>v(o,a,e)):v(o,n,e)}class E{constructor(t){this.language=t.language,this.element=t.element,this.textArea=document.createElement("textarea"),this.element.appendChild(this.textArea)}get value(){return this.textArea.value}set value(t){this.textArea.value=t}remove(){this.textArea.remove()}}let h=null;const f=document.getElementById("attach");function y(){h===null?(h=L(o=>new E(o),document.getElementById("editor"),{url:"https://raw.githubusercontent.com/moroboxai/moroboxai-games/master/pong/agent.*",language:"lua",width:"500px",height:"400px",onRun:o=>console.log("run",o),onStop:()=>console.log("stop"),onLanguageChanged:o=>console.log("selected language",o)}),f.textContent="Detach Editor"):(h.remove(),h=null,f.textContent="Attach Editor")}f.onclick=()=>y();y();
